<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>家計簿一覧</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-4">

    <!-- 前文 -->
    <div class="alert alert-info text-center" role="alert">
      <h4 class="alert-heading">今月の家計を見直してみましょう</h4>
      <p>このページでは、選択した年月の収入・支出・差額を確認できます。カテゴリ別の支出グラフや、登録された明細も一覧で表示されます。</p>
      <hr>
      <p class="mb-0">月を切り替えて、過去の家計も振り返ってみましょう。</p>
    </div>

    <!-- 月切り替えフォーム -->
    <form method="get" action="/accounts" class="row g-3 align-items-center mb-4">
      <div class="col-auto">
        <label class="form-label">表示する年月</label>
      </div>
      <div class="col-auto">
        <select name="year" class="form-select">
          <option th:each="y : ${#numbers.sequence(2000,2026)}"
                  th:value="${y}" th:text="${y}" th:selected="${y == year}"></option>
        </select>
      </div>
      <div class="col-auto">
        <select name="month" class="form-select">
          <option th:each="m : ${#numbers.sequence(1, 12)}"
                  th:value="${m}" th:text="${m}" th:selected="${m == month}"></option>
        </select>
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-primary">表示</button>
      </div>
    </form>

    <!-- 集計表示 -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title" th:text="${year}+'年'+${month}+'月の集計'"></h5>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">収入合計: <span th:text="${income}+'円'"></span></li>
          <li class="list-group-item">支出合計: <span th:text="${expense}+'円'"></span></li>
          <li class="list-group-item">差額: <span th:text="${balance}+'円'"></span></li>
        </ul>
      </div>
    </div>

    <!-- グラフ -->
    <div class="text-center mb-5">
      <h2 class="mb-3">カテゴリ別支出グラフ</h2>
      <div style="max-width: 100%; margin: 0 auto;">
        <canvas id="categoryChart"></canvas>
      </div>
    </div>

    <!-- 収入カテゴリグラフ -->
     <div class="text-center mb-5">
    <h2 class="mb-3">カテゴリ別収入グラフ</h2>
    <div style="max-width: 100%; margin: 0 auto;">
    <canvas id="incomeChart"></canvas>
    </div>
      </div>
    <!-- 月別推移グラフ -->
     <div class="text-center mb-5">
  <h2 class="mb-3">月別収支推移グラフ</h2>
  <div style="max-width: 100%; margin: 0 auto;">
    <canvas id="monthlyChart"></canvas>
  </div>
</div>



    <!-- 新規登録リンク -->
    <div class="mb-3 text-end">
      <a href="/accounts/new" class="btn btn-success">新規登録</a>
    </div>

    <!-- 一覧テーブル -->
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>日付</th>
            <th>収支</th>
            <th>カテゴリ</th>
            <th>項目</th>
            <th>金額</th>
            <th>メモ</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="account : ${accounts}">
            <td th:text="${account.date}"></td>
            <td th:text="${account.type}"></td>
            <td th:text="${account.category}"></td>
            <td th:text="${account.item}"></td>
            <td th:text="${account.amount}"></td>
            <td th:text="${account.memo}"></td>
            <td>
              <a th:href="@{'/accounts/delete/' + ${account.id}}" class="btn btn-sm btn-danger">削除</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>

  <!-- グラフ用データ埋め込み -->
  <script th:inline="javascript">
    /*<![CDATA[*/
    window.categoryData = /*[[${categoryTotals}]]*/ {};
    window.incomeCategoryData = /*[[${incomeCategoryTotals}]]*/ {};
    window.monthlyIncome = /*[[${monthlyIncome}]]*/ {};
    window.monthlyExpense = /*[[${monthlyExpense}]]*/ {};

    /*]]>*/

  </script>

  <!-- Chart.js 読み込み -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/js/categoryChart.js"></script>
</body>
</html>